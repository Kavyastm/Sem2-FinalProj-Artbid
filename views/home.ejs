<%- include('layouts/innerheader'); -%>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>

<body>
    <div style="height: 50px;">
       
    </div>
    
    <% if(art[0].art.length > 0) { %>

        <div class="col-9"> 
           
        <!-- Code for viewing the Post -->
        <% art[0].art.forEach((product,key) => { %>

            <div class="card" style="
            margin-left: 28%;
        "> 
                <div class="top"> 
                    <div class="userDetails"> 
                        <div class="profilepic"> 
                            <div class="profile_img"> 
                                <div class="image"> 
                                    <img src= 
                                        alt="img8"> 
                                </div> 
                            </div> 
                        </div> 
                        <h3><%= product.userData[0].userName %> 
                            <br> 
                            <span><%= product.userData[0].about %></span> 
                    </h3> 
                    </div> 
                    <div> 
                        <span class="dot"> 
                            <i class="fas fa-ellipsis-h"></i> 
                        </span> 
                    </div> 
                </div> 
                <div class="imgBx"> 
                    <a href="/art-detail/<%= product._id %>">
                    <img src="<%= product.image %>"
                    class="cover" />
                </a>
                </div> 
                <div class="bottom"> 
                    <div class="actionBtns"> 
                        <div class="left"> 
                             
                        </div> 
                    </div> 
                    <a href="/art-detail/<%= product._id %>"> 
                        <p class="message"> 
                        <b><%= product.title %></b> 
                        </p> 

                    </a> 

                    <span> 
                        <p class="message"> 
                        <b><%= product.description %></b> 
                        </p> 

                    </span> 
                    <span> 
                        <p class="message"> 
                        <b>$<%= product.min_bid %></b> 
                        </p> 
                        
                    </span> 
                    <span> 
                        <p class="message"> 
                        
                        <b>Start Date & Time:</b> <%= product.start_date %> <%= product.start_time %>
                        </p> 
                    </span> 
                    <span> 
                        <p class="message"> 
                        <b>End Date & Time:</b> <%= product.end_date %> <%= product.end_time %>
                        </p> 
                    </span> 
                    <!-- <button type="button" class="btn btn-info btn-lg" data-toggle="modal" data-target="#myModal" onclick="openModel('<%= product._id %>')">View all comments</button> -->
                
                    

                    
                    <!-- <div class="addComments"> 
                        <div class="reaction"> 
                            <h3> 
                            <i class="far fa-smile"></i> 
                            </h3> 
                        </div> 
                        <input type="hidden"
                            class="text productId" id="productId"
                           value="<%= product._id %>">
                        <input type="text"
                            class="text commentId inputError" id="commentId"
                            placeholder="Add a comment..."> 
                            <span role="alert" class="requiredError" aria-hidden="true">
                                Please enter Comment
                            </span><br>
                        <button class="btn btn-danger" style="background-color: #bd2130;" onclick="postComment(event,'<%= key %>')">Post</a> 
                    </div>  -->
                </div>  
            </div> <br><br>

            <% }) %>
            <!-- <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalScrollableTitle" aria-hidden="true">
                <div class="modal-dialog modal-dialog-scrollable" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="exampleModalScrollableTitle">All Comments</h5>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                      </button>
                    </div>
                    
                           
                         
                        
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>
                  </div>
                </div> -->
        </div> 
    <% } else { %>

            <div class="col-9 table-data"> </div>
     <% } %>
          
</body>
<script>
     function openModel(id) {
        
        $.ajax({
            type: "POST",
            url: 'http://localhost:8081/get-all-comments',
            data : {
                id: id
                // will be accessible in $_POST['data1']
            },
            success: function(comment){
                console.log(comment)

                return {
                        comment : comment,
                    }
            },
            dataType: "json"
        });
    }
    
    function postComment(e,key) {
        // $("#idForm").submit(function(e) {
        e.preventDefault(); // avoid to execute the actual submit of the form.
        // const comment = document.getElementById('commentId').value;
        const comment = document.getElementsByClassName("commentId")[key].value;
        const product_id = document.getElementsByClassName("productId")[key].value;
        console.log(comment,product_id,e,key)
        var form = $(this);
        // var actionUrl = form.attr('action');
        if(comment){
            $.ajax({
                type: "POST",
                url: 'http://localhost:8081/post-comment',
                data : {
                    id : product_id,
                    comment : comment // will be accessible in $_POST['data1']
                },
                success: function(data)
                {
                    document.getElementsByClassName("commentId")[key].value = "";
                }
            });
        }else{
            const userNameField = document.getElementsByClassName("inputError");
            const showRequiredErr = document.getElementsByClassName("requiredError");
            console.log(showRequiredErr,!userNameField[key],key)
            showRequiredErr[key].classList.add("visible");
            userNameField[key].classList.add("invalid");
            showRequiredErr[key].setAttribute("aria-hidden", false);
            showRequiredErr[key].setAttribute("aria-invalid", true);
            setTimeout(() => {
                showRequiredErr[key].classList.remove("visible");
                userNameField[key].classList.remove("invalid");
                showRequiredErr[key].setAttribute("aria-hidden", true);
                showRequiredErr[key].setAttribute("aria-invalid", false);
            }, "2000");
        }
       

}
</script>

<%- include('layouts/footer'); -%>